{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Hagaaty AI Blog.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's full name."
        },
        "role": {
          "type": "string",
          "description": "User role, either 'user' or 'admin'.",
          "enum": ["user", "admin"]
        },
        "balance": {
          "type": "number",
          "description": "User's advertising credit balance."
        },
        "points": {
          "type": "number",
          "description": "Points earned by the user for triggering the autonomous agent."
        },
        "lastMarketingTriggerAt": {
          "type": "string",
          "description": "Timestamp of the last time the user triggered the marketing agent.",
          "format": "date-time"
        },
        "createdAt": {
            "type": "string",
            "description": "Timestamp of when the user account was created.",
            "format": "date-time"
        },
        "referralCode": {
            "type": "string",
            "description": "The unique code assigned to this user for referrals."
        },
        "referralEarnings": {
            "type": "number",
            "description": "Total earnings from the referral program."
        },
        "referredBy": {
            "type": "string",
            "description": "The referral code of the user who referred this user."
        },
        "status": {
            "type": "string",
            "description": "The status of the user account.",
            "enum": ["active", "suspended"]
        },
        "ancestors": {
          "type": "array",
          "description": "An ordered list of up to 5 user UIDs representing the MLM upline. The first element is the direct referrer.",
          "items": {
            "type": "string"
          },
          "maxItems": 5
        },
        "directReferralsCount": {
            "type": "number",
            "description": "Total number of users directly referred by this user."
        },
        "achievements": {
          "type": "array",
          "description": "A list of achievements (badges) earned by the user.",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Unique ID for the achievement (e.g., 'ad_pioneer')."
              },
              "name": {
                "type": "string",
                "description": "Display name of the achievement (e.g., 'رائد الإعلانات')."
              },
              "awardedAt": {
                "type": "string",
                "format": "date-time",
                "description": "Timestamp of when the achievement was awarded."
              }
            },
            "required": ["id", "name", "awardedAt"]
          }
        }
      },
      "required": [
        "id",
        "email",
        "displayName",
        "role",
        "balance",
        "points",
        "createdAt",
        "status",
        "ancestors",
        "directReferralsCount",
        "achievements"
      ]
    },
    "Article": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Article",
      "type": "object",
      "description": "Represents a blog article generated or created within the Hagaaty AI Blog.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Article entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the article."
        },
        "content": {
          "type": "string",
          "description": "The main content of the article (likely HTML or Markdown)."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to User who created the article. (Relationship: User 1:N Article - Creation)"
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category the article belongs to. (Relationship: Category 1:N Article)"
        },
        "tagIds": {
          "type": "array",
          "description": "References to Tags associated with the article. (Relationship: Tag N:N Article)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the article was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the article was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "authorId",
        "categoryId",
        "createdAt",
        "updatedAt"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for organizing blog articles.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Tag": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tag",
      "type": "object",
      "description": "Represents a tag associated with blog articles.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Tag entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the tag."
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership ensures only the authenticated user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/articles/{articleId}",
        "definition": {
          "entityName": "Article",
          "schema": {
            "$ref": "#/backend/entities/Article"
          },
          "description": "Stores blog articles. Includes 'authorId' for authorization. This denormalization enables querying articles by author and simplifies security rules.",
          "params": [
            {
              "name": "articleId",
              "description": "The unique identifier of the article."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores categories for articles. Accessible to all users for reading.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier of the category."
            }
          ]
        }
      },
      {
        "path": "/tags/{tagId}",
        "definition": {
          "entityName": "Tag",
          "schema": {
            "$ref": "#/backend/entities/Tag"
          },
          "description": "Stores tags for articles. Accessible to all users for reading.",
          "params": [
            {
              "name": "tagId",
              "description": "The unique identifier of the tag."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/campaigns/{campaignId}",
        "definition": {
          "entityName": "Campaign",
          "description": "Stores ad campaigns created by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns the campaign."
            },
            {
              "name": "campaignId",
              "description": "The unique identifier of the campaign."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to optimize for security, scalability, and maintainability. User data is stored under `/users/{userId}` with path-based ownership. Admin roles are included to grant wider access for management. Articles, Categories, and Tags are in top-level collections for easy querying and public access. Ad campaigns are a subcollection under the user who created them (`/users/{userId}/campaigns/{campaignId}`), ensuring that users can only access their own campaigns, while admins can use collection group queries to view all campaigns across all users."
  }
}
